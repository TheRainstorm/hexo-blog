---
title: windows相关
date: 2022-12-05 15:49:50
tags:
- windows
categories:
- 学习
---

windows相关
<!-- more -->

## 系统维护

### 用户

查看用户
```
C:\Windows\System32>net user

\\S3-PRO 的用户帐户

-------------------------------------------------------------------------------
15440                    Administrator            DefaultAccount
Guest                    joker                    WDAGUtilityAccount
yfy
命令成功完成。
```

启用用户
```
net user Administrator /active:yes  # 启动Administrator用户
net user Administrator password  # 设置用户密码
```

全部命令
```
NET USER
[username [password | *] [options]] [/DOMAIN]
         username {password | *} /ADD [options] [/DOMAIN]
         username [/DELETE] [/DOMAIN]
         username [/TIMES:{times | ALL}]
         username [/ACTIVE: {YES | NO}]
```

添加用户
```
net user <user_name> <passwd> /add
```

设置权限
```
net localgroup administrators [username] /add
```

[How to Create an Admin User Account Using CMD Prompt (Windows) « Operating Systems :: WonderHowTo](https://operating-systems.wonderhowto.com/how-to/create-admin-user-account-using-cmd-prompt-windows-0125689/)

### 本地组策略编辑器

win11-home没有，需要自己安装
```
gpedit.msc
```

计算机配置-windows设置-安全设置-本地策略
- 用户权限分配
  - 拒绝本地登录
  - 拒绝从网络访问这台计算机
  - 拒绝通过远程桌面服务登录
- 安全选项
  - 账户：管理员账户状态。（即Administrator是否可见）
  - 

### 网络

#### 路由表

```
route print -6
```

#### 查看neigh

```
netsh interface ipv6 show neighbors
```

#### 修改路由优先级

```
ROUTE [-f] [-p] [-4|-6] command [destination]
                  [MASK netmask]  [gateway] [METRIC metric]  [IF interface]
                  
route print -4
route CHANGE 0.0.0.0 MASK 0.0.0.0 192.168.1.1 METRIC 30 IF 17 #IF从print中获得

route ADD 192.168.1.0 MASK 255.255.255.0 192.168.1.1 METRIC 1 IF 4
```

#### 修改ipv6，ipv4优先级

[Windows10设置IPv4/v6访问优先级 | IP查询(ipw.cn)](https://ipw.cn/doc/ipv6/user/ipv4_ipv6_prefix_precedence.html)

 IPv6(`::/0`) 
 IPv4(`::ffff:0:0/96`)
 
```
C:\Users\yfy>netsh interface ipv6 show prefixpolicies
查询活动状态...

优先顺序    标签   前缀
----------  -----  --------------------------------
        50      0  ::1/128
        40      1  ::/0
        35      4  ::ffff:0:0/96
        30      2  2002::/16
         5      5  2001::/32
         3     13  fc00::/7
         1     11  fec0::/10
         1     12  3ffe::/16
         1      3  ::/96

# 将::ffff:0:0/96设置到::/0前面即可
netsh interface ipv6 set prefixpolicy ::ffff:0:0/96 100 4
```

### 开启ssh

#### 生成ssh key

复制于tldr命令输出

```
- Generate an RSA 4096 bit key with email as a comment:
   ssh-keygen -t rsa -b 4096 -C "{{email}}"
```

#### 使用ssh key ssh登录windows(挺麻烦)

1. windows开启ssh server。
	搜索栏输入管理可选功能，搜索openssh 服务器安装
	
2. 编辑C:/ProgramData/ssh/sshd_config

   ```
   确保以下3条没有被注释
   PubkeyAuthentication yes
   AuthorizedKeysFile	.ssh/authorized_keys
   PasswordAuthentication no
   
   确保以下2条有注释掉
   #Match Group administrators
   #       AuthorizedKeysFile __PROGRAMDATA__/ssh/administrators_authorized_keys
   ```


3. 客户端将客户端的public key手动复制到（使用ssh-copy-id貌似会输出乱码失败）
	~/.ssh/authorized_keys
4. windows重新启动sshd（管理员）
	net stop sshd
	net start sshd

### 进程管理

[How do you list all processes on the command line in Windows? - Super User](https://superuser.com/questions/914782/how-do-you-list-all-processes-on-the-command-line-in-windows)

```
tasklist 
```

重启有道词典

```
taskkill /im YoudaoDict.exe /f 

start /d"D:\path\to\" YoudaoDict.exe
```


## SMB共享

### 本地组管理

[Windows 10/ 11 下安全并正确地使用 SMB 共享_软件应用_什么值得买 (smzdm.com)](https://post.smzdm.com/p/akxwkxqk/)
- 创建一个专用用户用于smb共享


### 将smb挂载到目录

windows 创建软链接  SMB软链接
对于大部分应用来说，软链接和原生的目录行为一样

```
mklink /d hexo-blog \\ryzen\Home\Documents\hexo-blog\source\_posts
```

这里的服务指：程序开机时自动在后台运行。和定时任务应该有点不同。


## windows定时任务
### sc命令

SC是用来与服务控制管理器和服务进行通信的命令行程序

```
C:\Users\yfy>sc create
描述:
        在注册表和服务数据库中创建服务项。
用法:
        sc <server> create [service name] [binPath= ] <option1> <option2>...

选项:
注意: 选项名称包括等号。
      等号和值之间需要一个空格。
 type= <own|share|interact|kernel|filesys|rec|userown|usershare>
       (默认 = own)
 start= <boot|system|auto|demand|disabled|delayed-auto>
       (默认 = demand)
 error= <normal|severe|critical|ignore>
       (默认 = normal)
 binPath= <.exe 文件的 BinaryPathName>
 group= <LoadOrderGroup>
 tag= <yes|no>
 depend= <依存关系(以 / (斜杠)分隔)>
 obj= <AccountName|ObjectName>
       (默认= LocalSystem)
 DisplayName= <显示名称>
 password= <密码>
```

不知道怎么添加命令行参数

貌似binPath可以包含参数，没试过

```
sc create redis binpath= ""C:\Software\server\Redis\redis-server.exe" --service-run "rdis.windows-service.conf"" start= auto

作者：LAMYMAY
链接：https://www.jianshu.com/p/73d8dd70f918
来源：简书
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。
```

### 小工具nssm

[NSSM - the Non-Sucking Service Manager](https://nssm.cc/)

nssm install显示添加服务的GUI界面

![](https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/picgo/20221205203345.png)


## windows小问题

### 网络显示未连接实际有网

测试以下两个域名dns解析是否正常
```
dns.msftncsi.com
www.msftconnecttest.com
```

### 删除文件管理器中的网盘

new bing
Q: 如何清除软件在windows文件管理器中注册的网盘
A: 如果您想删除注册表中的网盘，请按照以下步骤操作：
1.  按下Win+R键打开运行窗口。
2.  输入regedit并按回车键打开注册表编辑器。
3.  在左侧导航栏中找到HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\NetDrive。
4.  右键单击NetDrive并选择删除。
5.  关闭注册表编辑器。

但是这里的路径不完全正确

谷歌：删除注册表中的网盘
得到许多类似问题

在regedit中手动搜索SeaDrive，可以找到位置，删除问题解决。

### 文件或目录损坏且无法读取

qbittorent移动种子时，我把进程强行杀掉了。导致磁盘上出现了文件夹无法删除的情况

解决办法，扫描修复文件系统
```
chkdsk /f C:
```

