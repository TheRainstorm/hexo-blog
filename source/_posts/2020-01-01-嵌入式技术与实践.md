---
title: 嵌入式技术与实践
date: 2020-01-01 00:00:00
tags:
- 嵌入式
categories:
- 阅读
---


# 嵌入式技术基础与实践 第五版

## 心得

1. 为什么单片机可以控制灯的亮灭，通用PC却没办法控制灯呢？（因为没有CPU到LED的接口也没有驱动程序）

1. 中断向量机制和MIPS采用的统一入口地址不太一样。中断向量机制硬件产生中断请求时，中断号是确定了的（通过中断控制器发送中断号），软件可以配置对应中断服务程序。而MIPS没有中断号的概念，通过软件检查Stastus寄存器，来确定是哪一个中断，跳转到对应中断服务程序。

   中断向量机制的CPU通常需要一个中断控制器，连接在总线上。中断控制器会给CPU提供中断号。

2. MCU本质就是一个微型计算机，包含CPU，存储器，I/O接口（控制器模块）。嵌入式开发就是要基于MCU搭建一个硬件系统（通过MCU的I/O接口连接各种需要被控制的外设），并逐层向上编写构件（驱动），最后基于构件编写嵌入式应用，从而完成需要的功能。

3. MCU由于需要通用性，使得用户可以基于MCU去搭建自己的系统，驱动自己的外设，因此每个引脚都复用多个功能。通过配置MCU内对应控制器的寄存器来配置引脚的功能。

   比如MSP432 100个引脚中有84个可以配置成GPIO引脚。只需要将MSP432分配的GPIO寄存器中的PxSEL0, PxSEL1寄存器（x表示端口号，有11个端口P1~P10和PJ）都置为0时，该端口的引脚即为GPIO功能。同样可以通过配置GPIO寄存器控制引脚方向作为输入还是输出，用于点亮LED灯或者接受开关输入。

   再比如MSP432有4个增强型通用串行通信接口模块(eUSCI)，也分配了若干寄存器。通过配置寄存器可以将对应引脚配置为UART的引脚或SPI的引脚。

   但是我们在FPGA上搭建SoC时，开发板上的灯、拨码开关和FGPA芯片的引脚是连好了的（由开发板的提供商基于FPGA芯片搭建），也就是说每个引脚作为输入还是输出是已经确定了的。我们能改变的只是——是否使用该外设。当然，不排除保留了一些引脚被接到扩展插口上（那一排排的黑色插孔）。因此在FPGA上搭建SoC后，实现外设驱动需要对外设的控制器进行配置。而嵌入式开发还多出了配置MCU内用于复用的模块寄存器。

<!-- more -->

[TOC]

## 第一章：概述

1. 在MCU出现之前，人们必须使用模拟电路、数字电路实现测控系统中的大部分计算与控制功能。

   在MCU出现后，**计算与控制由软件实现**，其它电子线路成为MCU的外围电路，承担输入、输出与执行动作等功能。

2. 常用术语

   1. 封装(Package)，用塑料、金属或陶瓷材料将集成电路封装在其中。

   2. PCB（Printed Circuit Board，印刷电路板）。电路原理图的实物化，实现各元件的布线。

   3. 常见存储器：RAM, ROM, PROM, EPROM, EEPROM, Flash Memory

   4. 几种接口发展：UART（异步串行通信接口，通用异步收发器，Universal Asynchronous Receiver Transmitters）->SPI（串行外设接口，Serial Peripheral Interface）->I2C（集成电路互联总线，Inter-Integrated Circuit）->USB（通用串行总线，Universal Serial Bus）

   5. 边界扫描测试协议JTAG（Joint Test Action Group，国际联合测试行动组）。对芯片进行测试的一种方式，能够获取芯片寄存器的内容，或测试器件间引脚的连接情况。

      -> SWD（Serial wire Debug，串行调试线）。使用更少针脚，是JTAG的高性能替代品。

   6. RTOS，实时操作系统

   7. 看门狗，用于检查程序是否跑分。程序跑飞后，由于无法清除掉看门狗的计时器，因此会导致CPU复位

   8. ISR（中断服务程序，Interrupt Service Routine）

## 第二章：ARM Cortex-M4F处理器

1. ARM Cortex处理器分为M、R、A系列。A：代表应用处理器，用于手机。M代表低功耗。
2. ARM v7是32位指令集，ARM v8是64位。Thumb是ARM中一种16位指令集，Thumb2是16/32混合指令集
3. MSP432是TI（德州仪器）生产的基于Cortex-M4F处理器的微控制器
4. ARM汇编参考《GUN汇编语法》

## 第三章：存储映像、中断源与硬件最小系统

2. MCU的引脚包含两类，一类是为MCU提供服务的引脚，如电源、复位、晶振等。另一类是MCU对外提供服务的引脚，也称为I/O端口资源类引脚。
2. MCU内部包含（1）CPU；（2）SRAM、ROM和Flash作为存储器；（3）I/O接口（控制器），如UART, I2C, SPI通信模块，JTAG和SWD的调试接口。
3. MCU已经对地址空间进行了分配。也为每个中断源分配了中断号。
4. MCU的硬件最小系统（基于MCU搭建的最小系统）是指可使内部程序运行的、规范的、可复用的核心构件系统。一般包含，电源，晶振，复位，写入调试器接口（如SWD；将程序写入芯片）

## 第四章：GPIO及程序框架

1. 主要介绍了如何编写GPIO的构件(gpio_init(port, pin, IN/OUT, STATUS))，再在此基础上编写控制小灯的构件(light_init(port, pin, ON/OFF))。
2. 嵌入式项目的标准结构（目录分类），CPU有关，MCU有关（寄存器地址映射），用户构建的电路相关UserBoard（如将LED灯连接到MCU上），顶层应用。
3. 介绍了链接脚本的内容含义。

## 第五章：嵌入式硬件构件与底层驱动构件基本规范

1. 硬件构件可以分为核心构件，中间构件，终端构件。核心构件只对外提供服务如MCU最小硬件系统，终端构件只对外提出需求如LED构件。
2. 嵌入式软件构件：
   - 面向芯片级的硬件驱动构件。如GPIO构件。
   - 面向实际应用硬件模块。如Light构件。
   - 面向算法，如链表、队列、排序算法等。

## 第六章：串行通信模块及第一个中断程序结构

1. 串行通信接口简称串口，UART或SCI(serial communication interface)。

2. 空闲状态是1，发送一个0表示一个字节传输开始，随后是字节数据，最后是1位或2位的停止位。开始位和停止位影响了串口的传输速率。

3. MCU输出的是TTL（晶体管-晶体管逻辑电平，Transistor-Transistor Logic），1和0的特征电压值是2.4V和0V。而RS232标准采用负逻辑（为了传输的更远），-15V到-3V为1，+3V到+15V为0。因此需要电平转换电路。

4. 9芯串行接口

   - 接收线信号检测

   - RxD 接收数据线
   - TxD发送数据线
   - DTR数据终端准备就绪
   - SG信号地
   - DSR数据通信设备准备就绪
   - RTS请求发送
   - CTS允许发送
   - 振铃提示

   常常使用精简的RS232通信，仅使用RxD、TxD和SG。其它为进行远程传输时接调制解调器用，有的也可以作为硬件握手信号（如RTS和CTS）

