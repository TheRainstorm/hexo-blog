---
title: WSL记录
date: 2020-10-11 23:04:42
tags:
---

## 概述

发现使用wsl + docker + vs code(remote wsl + remote container插件)可以让开发、部署、运行整个流程变得更加方便。因此想写一篇文章记录接触wsl后了解到的一些知识以及遇到的一些问题以及解决方案（长期更新）。

<!--more-->

## WSL1原理

微软官方wsl博客中有一个系列文章介绍wsl1的原理，在阅读其中关于系统调用内容后发现没有想象中的难懂，反而学到了许多知识，因此把它记录下来。

系列博客

1. [Windows Subsystem for Linux Overview](https://docs.microsoft.com/zh-cn/archive/blogs/wsl/windows-subsystem-for-linux-overview)
2. [Pico Process Overview](https://docs.microsoft.com/zh-cn/archive/blogs/wsl/pico-process-overview)
3. [WSL system Calls](https://docs.microsoft.com/zh-cn/archive/blogs/wsl/wsl-system-calls)
4. [WSL File System Support](https://docs.microsoft.com/zh-cn/archive/blogs/wsl/wsl-file-system-support)
5. [其它](https://docs.microsoft.com/zh-cn/archive/blogs/wsl/)

## 设置wsl内存与cpu资源

编辑` C:\Users\<yourUserName>\.wslconfig `内容

```
[wsl2]
kernel=C:\\temp\\myCustomKernel
memory=4GB # Limits VM memory in WSL 2 to 4 GB
processors=2 # Makes the WSL 2 VM use two virtual processors
```

其它资源设置参考[1]

## 访问网络应用程序

### 从 Windows (localhost) 访问 Linux 网络应用

直接通过localhost访问（注意，通过127.0.0.1访问会失败）

>  如果运行的是较旧版本的 Windows（版本 18945 或更低版本），则需要获取 Linux 主机 VM 的 IP 地址 

### 从 Linux（主机 IP）访问 Windows 网络应用

如设置git使用windows的socks代理。

```
➜  ~ cat /etc/resolv.conf
# This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:
# [network]
# generateResolvConf = false
nameserver 172.31.144.1
```

使用该ip访问windows网络应用（注意，每次启动wsl该ip会变化，目前还没找到解决方式）

### 从局域网 (LAN) 访问 WSL 2 分发版

使用wsl1时，wsl与主机共用ip，因此如果计算机设置为可供 LAN 访问，那么在 WSL 中运行的应用程序也可供在 LAN 中访问。 

使用wsl2时，wsl有一个带有其自己独一无二的 IP 地址的虚拟以太网适配器（和主机所在的网段不一样，如：主机连接的路由器的网段为192.168.1.0/24，而wsl所在的网段为172.31.144.0/20，wsl上网需要经过主机进行NAT转换），因此需要执行与常规虚拟机相同的步骤（端口转发）。

 下面是一个示例 PowerShell 命令，用于添加侦听主机上的端口 4000 的端口代理并将其连接到端口 4000，并使用 IP 地址172.31.157.77（WSL的ip地址）连接到 WSL 2 VM。 

```
netsh interface portproxy add v4tov4 listenport=4000 listenaddress=0.0.0.0 connectport=4000 connectaddress=172.31.157.77
```

其它参考[2]

## 参考

1. [microsoft doc: wsl-config](https://docs.microsoft.com/zh-cn/windows/wsl/wsl-config#configure-global-options-with-wslconfig)

2. [microsoft doc: wsl1/2 compare](https://docs.microsoft.com/zh-cn/windows/wsl/compare-versions#accessing-network-applications)