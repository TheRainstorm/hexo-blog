---
title: 不同情况下的内网穿透
date: 2022-02-11 01:18:16
tags: [如何实现网络自由, 折腾]
---

#### 技术说明

- ddns：将动态的公网ip地址绑定到一个域名上

- 通过VPN访问内网：在互联网上建立一个隧道，通过隧道可实现访问内网设备

- 端口转发：将发送给A的某个端口的数据转发给B的某个端口。对于访问者来说，访问的是A，实际响应的是B

#### 网络状况

设备A位于路由器后，设备B想要远程连接A。以下是设备B分别使用ipv4和ipv6访问A时不同情况的处理方式。
<!--more-->

- ipv4

  - 路由器WAN口有公网ipv4地址

    1. 方式一：路由器ddns + 路由器端口转发

    2. 方式二：wireguard，B通过VPN连接到路由器上，进而访问内网设备

  - 路由器WAN口为内网ipv4地址

    1. 方式一：A上安装Zerotier，B上也安装Zerotier，AB便可以通过虚拟的Zerotier地址相互访问。
    2. 方式二：在路由器上安装Zerotier，同时在Zerotier central中配置转发规则（具体方式自行搜索）。B上安装Zerotier，此时B不仅可以访问路由器，也可以访问路由器LAN中的其它设备，因此可以访问A

    - *注：Zerotier连接的两个设备间的通信不一定全靠Zerotier服务器中转，如果两个设备中间的NAT结构比较好的话，Zerotier会通过**UDP打洞**的方式，让两个设备直接通信。*

- ipv6

  - 路由器WAN口和A均有公网ipv6地址

    - 直接在PC上配置ddns

      注：1）如果PC无ipv6，那么配置路由器不要使用NAT6

      2）ipv6的端口转发是不必要的

    - *注：目前所有ISP一般都提供了公网ipv6地址，可能需要在光猫中开启。*

- 特殊情况

  - 虽然无公网ipv4地址，但是如果A, B可以ping通对方（比如都位于校园网中），则可以使用ip地址直接远程连接。
  - 虽然有公网ipv4/ipv6地址，但是B可能仍无法访问A。比如，校园网虽然提供了公网地址，但是校外访问时会被防火墙拦截。
    - 这种情况wireguard仍然有效，不会被防火墙拦截
    - 一般只对ipv4地址进行拦截，ipv6基本不怎么拦截，因此可以使用ipv6

#### 网络穿透+远程桌面用例

*注：括号内为要求*

- （同时连接在校园网上）去实验室做实验时，直接远程连接寝室电脑，再也不用带电脑了。
- （同时连接在校园网上）在教室的多媒体电脑上远程连接寝室电脑（有一次使用这种方式救急拷贝了演讲的ppt）
- （同时连接在校园网上）在实验室，串流玩寝室的台式电脑。
- （校园网有公网ipv4）放假在家，通过wireguard远程访问位于学校的台式电脑。